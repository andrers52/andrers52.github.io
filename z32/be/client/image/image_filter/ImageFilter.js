"use strict";import resourceStore from"../../singleton/ResourceStore.js";export default function ImageFilter(t,a,...e){let r=a?t:resourceStore.cloneImage(t),o=resourceStore.getImageData(r);for(let t=0;t<e.length;t+=2){let a=t+1<e.length?e[t+1]:null;o=e[t](o,a)}return resourceStore.setImageData(r,o),r};if(ImageFilter.tmpCanvas=document.createElement("canvas"),ImageFilter.tmpCtx=ImageFilter.tmpCanvas.getContext("2d"),ImageFilter.createImageData=function(t,a){return this.tmpCtx.createImageData(t,a)},ImageFilter.convolute=function(t,a,e){for(var r=Math.round(Math.sqrt(a.length)),o=Math.floor(r/2),n=t.data,l=t.width,i=t.height,m=l,g=i,h=ImageFilter.createImageData(m,g),u=h.data,c=e?1:0,f=0;f<g;f++)for(var v=0;v<m;v++){for(var s=f,d=v,I=4*(f*m+v),F=0,M=0,p=0,w=0,x=0;x<r;x++)for(var C=0;C<r;C++){var D=s+x-o,S=d+C-o;if(D>=0&&D<i&&S>=0&&S<l){var y=4*(D*l+S),A=a[x*r+C];F+=n[y]*A,M+=n[y+1]*A,p+=n[y+2]*A,w+=n[y+3]*A}}u[I]=F,u[I+1]=M,u[I+2]=p,u[I+3]=w+c*(255-w)}return h},!window.Float32Array)var Float32Array=Array;ImageFilter.convoluteFloat32=function(t,a,e){for(var r=Math.round(Math.sqrt(a.length)),o=Math.floor(r/2),n=t.data,l=t.width,i=t.height,m=l,g=i,h={width:m,height:g,data:new Float32Array(m*g*4)},u=h.data,c=e?1:0,f=0;f<g;f++)for(var v=0;v<m;v++){for(var s=f,d=v,I=4*(f*m+v),F=0,M=0,p=0,w=0,x=0;x<r;x++)for(var C=0;C<r;C++){var D=4*(Math.min(i-1,Math.max(0,s+x-o))*l+Math.min(l-1,Math.max(0,d+C-o))),S=a[x*r+C];F+=n[D]*S,M+=n[D+1]*S,p+=n[D+2]*S,w+=n[D+3]*S}u[I]=F,u[I+1]=M,u[I+2]=p,u[I+3]=w+c*(255-w)}return h};