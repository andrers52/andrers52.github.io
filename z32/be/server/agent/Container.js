"use strict";import Assert from"../../../libs/arslib/util/assert.js";import EFunction from"../../../libs/arslib/enhancements/e-function.js";import Vector from"../../../libs/arslib/geometry/Vector.js";import Rectangle from"../../../libs/arslib/geometry/Rectangle.js";import{createAgent}from"./Agent.js";export default function createContainer(e,t,n,i){let o=createAgent(null,100,100,!1);t&&Assert.assertIsValidString(t,["vertical","horizontal"],"Invalid container orientation given:"+t),o.isVisible=!1,o.orientation=t||"horizontal",o.rectangle=i||new Rectangle(null,new Vector(10,10)),o.isSolid=!1,o.padding=n||1;let r=[];function l(){let e=o.padding*(r.length-1),t=(o.rectangle.size.x-("horizontal"===o.orientation?e:0))/("horizontal"===o.orientation?r.length:1),n=(o.rectangle.size.y-("vertical"===o.orientation?e:0))/("vertical"===o.orientation?r.length:1);r.forEach(function(e){e.setSize(new Vector(t,n))})}function a(){let e,n,i=r.first().getSize();"vertical"===o.orientation?(e=o.getPosition().x,n=o.rectangle.topLeft().y-i.y/2):(n=o.getPosition().y,e=o.rectangle.bottomLeft().x+i.x/2),r.first().setPosition(new Vector(e,n),!0),function(){let e={vertical:"below",horizontal:"right"};r.forEach(function(n,i){0!==i&&n.moveRelativeToAgent(r[--i],e[t],o.padding,!0)})}()}o.addAgent=function(e){return e.container=o,r.add(e),l(),a(),o},o.removeAgent=function(e){return r.removeElement(e),l(),a(),o},o.getElement=function(e){return r[e]},o.getCollection=function(){return r},e&&e.forEach(e=>o.addAgent(e));let c=o.move;o.move=function(e,t){if(!t){if(!o.checkMove(e))return!1;for(let t=0;t<r.length;t++)if(!r[t].checkMove(e))return!1}return c.call(o,e,!0),r.forEach(t=>c.call(t,e,!0)),!0};let s=o.die;return o.die=EFunction.sequence(function(){for(var e=0;e<r.length;e++)r[e].die()},s,o),o};