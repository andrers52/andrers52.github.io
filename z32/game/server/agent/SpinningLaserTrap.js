"use strict";import EFunction from"../../../libs/arslib/enhancements/e-function.js";import Random from"../../../libs/arslib/util/random.js";import BEServer from"../../../be/server/singleton/BEServer.js";import connector from"../../../be/server/singleton/Connector.js";import{createAgent}from"../../../be/server/agent/Agent.js";import Turnable from"../../../be/server/agent/mixin/Turnable.js";import HasBehavior from"../../../be/server/agent/mixin/HasBehavior.js";import HasEnergy from"../../../be/server/agent/mixin/HasEnergy.js";import SensingAgent from"../../../be/server/agent/mixin/SensingAgent.js";import GameServerZ32Definitions from"../GameServerZ32Definitions.js";import createLaser from"./weapons/laser/Laser.js";import GameCommonDefinitions from"../../common/GameCommonDefinitions.js";import createShipSplash from"./ShipSplash.js";export default function createSpinningLaserTrap(e=0,n=0){let r=GameServerZ32Definitions;const i=3*r.SHIP_TURN_ANGLE,o=2*Math.PI/4;let t=createAgent(GameCommonDefinitions.SPINNING_LASER_TRAP_IMAGE,r.SPINNING_LASER_TRAP_WIDTH,r.SPINNING_LASER_TRAP_HEIGHT,!0,e,n);if(!t)return null;return t.isAI=!0,t.thrust=0,t.userScore=0,Turnable.call(t,2),t.currentWeapon="laser",t.alternateWeaponTimeLeft=0,t.die=EFunction.sequence(function(){createShipSplash(t),connector.playProceduralSoundInClient("SHIP_DIE_AUDIO_OBJECT_DESCRIPTION",t.getPosition()),BEServer.currentApp.createNewSpinningLaserTrapAtRandomPosition()},t.die,t),t.onHittingWorldBorder=function(){t.die()},HasBehavior.call(t,function(){return t.increaseEnergy(r.SHIP_GENERATOR_ENERGY_STEP),t}),HasEnergy.call(t,GameCommonDefinitions.BONUS_ENERGY_ENERGY,GameCommonDefinitions.AI_SHIP_MAX_ENERGY),t.fire=function(e){if(!Random.occurrenceProbability(r.SPINNING_LASER_TRAP_INITIAL_NOT_FIRE_PROBABILITY-e.userScore/1e5)&&t.decreaseEnergy(r.LASER_FIRING_ENERGY_COST,!0))for(let e=0;e<4;e++)createLaser(t,t.orientation+o*e)},t.onSensingUserAgent=function(e){let n=e.agent;t.orientation+=i,t.fire(n)},SensingAgent.call(t,e=>Number.isInteger(e.userId),400),t.onCollision=function(e){e.decreaseEnergy&&e.decreaseEnergy(t.energy,!0)},t};