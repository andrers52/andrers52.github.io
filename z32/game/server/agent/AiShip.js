"use strict";import EFunction from"../../../libs/arslib/enhancements/e-function.js";import EArray from"../../../libs/arslib/enhancements/e-array.js";import Vector,{vect}from"../../../be/common/geometry/Vector.js";import Random from"../../../libs/arslib/util/random.js";import GameServerZ32Definitions from"../GameServerZ32Definitions.js";import GameCommonDefinitions from"../../common/GameCommonDefinitions.js";import BEServer from"../../../be/server/singleton/BEServer.js";import connector from"../../../be/server/singleton/Connector.js";import{createAgent}from"../../../be/server/agent/Agent.js";import createLaser from"./weapons/laser/Laser.js";import createMissile from"./weapons/missile/Missile.js";import createMine from"./weapons/mine/Mine.js";import Turnable from"../../../be/server/agent/mixin/Turnable.js";import HasBehavior from"../../../be/server/agent/mixin/HasBehavior.js";import HasEnergy from"../../../be/server/agent/mixin/HasEnergy.js";import SensingAgent from"../../../be/server/agent/mixin/SensingAgent.js";import createShipSplash from"./ShipSplash.js";let names=["James","David","George","John","Richard","Kenneth","Robert","Charles","Steven","Michael","Joseph","Edward","William","Thomas","Brian","Amelia","Olivia","Emily","Ava","Isla","Jessica","Poppy","Isabella","Sophie","Mia","Ruby","Lily","Grace","Evie","Sophia","Ella","Scarlett","Chloe","Isabelle","Freya","Charlotte","Sienna","Daisy","Phoebe","Millie","Eva","Alice","Lucy","Florence","Sofia","Layla","Lola","Holly","Imogen","Molly","Matilda","Lilly","Rosie","Elizabeth","Erin","Maisie","Lexi","Ellie","Hannah","Evelyn","Abigail","Elsie","Summer","Megan","Jasmine","Maya","Amelie","Lacey","Willow","Emma","Bella","Eleanor","Esme","Eliza","Georgia","Harriet","Gracie","Annabelle","Emilia","Amber","Ivy","Brooke","Rose","Anna","Zara","Leah","Mollie","Martha","Faith","Hollie","Amy","Bethany","Violet","Katie","Maryam","Francesca","Julia","Maria","Darcey","Isabel","Tilly","Maddison","Victoria","Isobel","Niamh","Skye","Madison","Darcy","Aisha","Beatrice","Sarah","Zoe","Paige","Heidi","Lydia","Sara","Oliver","Jack","Harry","Jacob","Charlie","Thomas","Oscar","William","James","George","Alfie","Joshua","Noah","Ethan","Muhammad","Archie","Leo","Henry","Joseph","Samuel","Riley","Daniel","Mohammed","Alexander","Max","Lucas","Mason","Logan","Isaac","Benjamin","Dylan","Jake","Edward","Finley","Freddie","Harrison","Tyler","Sebastian","Zachary","Adam","Theo","Jayden","Arthur","Toby","Luke","Lewis","Matthew","Harvey","Harley","David","Ryan","Tommy","Michael","Reuben","Nathan","Blake","Mohammad","Jenson","Bobby","Luca","Charles","Frankie","Dexter","Kai","Alex","Connor","Liam","Jamie","Elijah","Stanley","Louie","Jude","Callum","Hugo","Leon","Elliot","Louis","Theodore","Gabriel","Ollie","Aaron","Frederick","Evan","Elliott","Owen","Teddy","Finlay","Caleb","Ibrahim","Ronnie","Felix","Aiden","Cameron","Austin","Kian","Rory","Seth","Robert","Albert","Sonny"];export default function createAiShip(e=0,a=0){let i=GameServerZ32Definitions;const n=4*i.SHIP_TURN_ANGLE;let r=createAgent(GameCommonDefinitions.AI_SHIP_IMAGE,i.SHIP_WIDTH,i.SHIP_HEIGHT,!0,e,a);if(!r)return null;r.isAI=!0;let o=r.getPosition();Turnable.call(r,2),r.speed=new Vector,r.name=EArray.choice(names),r.userScore=0;new Vector;r.thrust=0,r.currentWeapon="laser",r.alternateWeaponTimeLeft=0,r.createLaser=EFunction.limitCallingRateWithDiscard(createLaser,i.LASER_FIRING_LATENCY),r.createMissile=EFunction.limitCallingRateWithDiscard(createMissile,i.MISSILE_FIRING_LATENCY),r.createMine=EFunction.limitCallingRateWithDiscard(createMine,i.MINE_FIRING_LATENCY),r.die=EFunction.sequence(function(){createShipSplash(r),connector.playProceduralSoundInClient("SHIP_DIE_AUDIO_OBJECT_DESCRIPTION",r.getPosition()),BEServer.currentApp.createNewAiShipAtRandomPosition()},r.die,r),r.onHittingWorldBorder=function(){r.die()},HasBehavior.call(r,function(){return"laser"!==r.currentWeapon&&(--r.alternateWeaponTimeLeft,0===r.alternateWeaponTimeLeft&&(r.currentWeapon="laser")),function(){if(r.speed.size()<s)return void(r.speed=vect());let e=r.speed.clone().multiplyByScalar(-t);r.speed.add(e)}(),r.move(r.speed),r.increaseEnergy(i.SHIP_GENERATOR_ENERGY_STEP),r}),HasEnergy.call(r,GameCommonDefinitions.BONUS_ENERGY_ENERGY,GameCommonDefinitions.AI_SHIP_MAX_ENERGY),r.fire=function(e){if(!Random.occurrenceProbability(i.AI_SHIP_INITIAL_NOT_FIRE_PROBABILITY-e.userScore/1e5))switch(r.currentWeapon){case"laser":r.decreaseEnergy(i.LASER_FIRING_ENERGY_COST)&&r.createLaser(r);break;case"missile":r.decreaseEnergy(i.MISSILE_FIRING_ENERGY_COST)&&r.createMissile(r);break;case"mine":r.decreaseEnergy(i.MINE_FIRING_ENERGY_COST)&&r.createMine(r)}},r.onSensingAgents=function(e){let a=e.find(e=>Number.isInteger(e.agent.userId));if(!a)return;let o=a.vector,t=a.agent,s=o.getAngle();o.size();Math.abs(s)-n<=0?r.fire(t):(r.orientation+=o.getAngle()<0?-n:n,function(e){let a=Vector.makeFromAngleAndSize(r.orientation,1),i=Vector.makeFromAngleAndSize(e,1);return a.x*i.x>=0||a.y*i.y>=0}(t.orientation)&&function(){let e=Vector.makeFromAngleAndSize(r.orientation,i.AI_SHIP_THRUST),a=i.AI_SHIP_THRUST*i.SHIP_THRUST_TO_ENERGY_FACTOR;r.decreaseEnergy(a)&&(r.thrust=i.AI_SHIP_THRUST,r.speed.addWithLimits(e,i.AI_SHIP_MAX_SPEED,-i.AI_SHIP_MAX_SPEED,!1))}())},SensingAgent.call(r,e=>void 0!==e.userId||e.isBonus,i.AI_SHIP_SENSING_DISTANCE,i.AI_SHIP_SENSING_DELAY);let t=.1,s=vect(t,t,t).size();return r.onMouseDownHit=function(){r.currentWeapon="laser"},r.onMouseMove=function(e){o=e},r.onCollision=function(e){e.decreaseEnergy&&e.decreaseEnergy(r.energy,!0)},r.changeWeaponToMissile=function(e){r.currentWeapon="missile",r.alternateWeaponTimeLeft=e},r.changeWeaponToMine=function(e){r.currentWeapon="mine",r.alternateWeaponTimeLeft=e},r};