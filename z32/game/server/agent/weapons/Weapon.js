"use strict";import Random from"../../../../libs/arslib/util/random.js";import Assert from"../../../../libs/arslib/util/assert.js";import EFunction from"../../../../libs/arslib/enhancements/e-function.js";import Vector from"../../../../be/common/geometry/Vector.js";import connector from"../../../../be/server/singleton/Connector.js";import{createAgent}from"../../../../be/server/agent/Agent.js";import HasBehavior from"../../../../be/server/agent/mixin/HasBehavior.js";import GameServerZ32Definitions from"../../GameServerZ32Definitions.js";import TimeToLive from"../../../../be/server/agent/mixin/TimeToLive.js";import Turnable from"../../../../be/server/agent/mixin/Turnable.js";export default function createWeapon({owner:e,createSplashFunction:i,pop_sound:n,impactEnergyCost:r,timeToLive:o,orientation:t,width:a,height:s,image:l,initialOrientationVariationMin:m=0,initialOrientationVariationMax:c=0,initialPositionRelativeToOwner:d="front",initialSpeed:p,behavior:u}){Assert.assertIsValidString(d,["front","back"]);let g=GameServerZ32Definitions,f=e.getSize().x/2+a/2;"back"===d&&(f*=-1);let v=t||e.orientation,b=Vector.makeFromAngleAndSize(v,f);b.add(e.getPosition());let S=createAgent(l,a,s,!1,b.x,b.y);return TimeToLive.call(S,o),Turnable.call(S),S.orientation=v+Random.randomFromInterval(m,c),S.speed=p,S.isWeapon=!0,S.onHittingWorldBorder=function(){S.die()},S.die=EFunction.sequence(S.die,function(e){e&&i&&i(S,e)},S),S.onOverlapping=function(i){i.equal(e)||i.isSolid&&i.isAlive&&(i.speed&&i.speed.add(S.speed.clone().normalize().multiplyByScalar(10)),e&&e.isAlive&&i.decreaseEnergy&&(e.userScore+=r,i.decreaseEnergy(r,!0)||(e.userScore+=g.KILL_OTHER_USER_POINTS)),connector.playProceduralSoundInClient(n,S.getPosition()),S.die(!0))},u&&HasBehavior.call(S,u),connector.playProceduralSoundInClient("WEAPON_PRODUCING_AUDIO_OBJECT_DESCRIPTION",S.getPosition()),S};