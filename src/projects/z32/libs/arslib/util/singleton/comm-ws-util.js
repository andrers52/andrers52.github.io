import Assert from"../assert.js";const AUTOMATIC_RECONNECT_TIME=1e4;export default class CommWSUtil{static start(t,e,s,o=!1){CommWSUtil._serverAddr=s,CommWSUtil._communicatingObject=t,CommWSUtil._autoReconnect=o,CommWSUtil.socket=new WebSocket(s),CommWSUtil.socket.onopen=(()=>{CommWSUtil.sendStatus(e)}),CommWSUtil.socket.onclose=(()=>{CommWSUtil._autoReconnect&&(console.log("Connection lost. Trying to reconnect..."),setTimeout(()=>{CommWSUtil.start(t,e,s,!0)},AUTOMATIC_RECONNECT_TIME))}),CommWSUtil.socket.onmessage=function(t){let e=JSON.parse(t.data);Assert.assertHasProperties(e,["messageType","method","args"]),Assert.assertIsEqual(e.messageType,"remoteCall","Unsupported message type"),Assert.assertIsFunction(CommWSUtil._communicatingObject[e.method]),Assert.assertIsArray(e.args),CommWSUtil._communicatingObject[e.method](...e.args)}}static end(){CommWSUtil._autoReconnect=!1,CommWSUtil.socket.close()}static sendStatus(t){CommWSUtil.socket&&CommWSUtil.socket.send(JSON.stringify({messageType:"status",info:t}))}static remoteCallConnectedUserByUserName(t,e,...s){Assert.assert("_"!==e.charAt(0),"Cannot call private methods"),CommWSUtil.socket.send(JSON.stringify({messageType:"remoteCallConnectedUserByUserName",userName:t,method:e,args:s}))}static remoteCall(t,e,...s){Assert.assert("_"!==e.charAt(0),"Cannot call private methods"),CommWSUtil.socket.send(JSON.stringify({messageType:"remoteCall",object:t,method:e,args:s}))}};