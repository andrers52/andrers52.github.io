"use strict";import Assert from"../../../libs/arslib/util/assert.js";import EFunction from"../../../libs/arslib/enhancements/e-function.js";import EArray from"../../../libs/arslib/enhancements/e-array.js";import connector from"../../singleton/Connector.js";export default function Animated(t,e){let n=2e3,i=this,r=null,a=[],s="notInitialized",o=!1,c=1,u={},m={},l={},d={};this.currentState="notInitialized";let f=0;function h(t){i.imageName=EArray.first(u[t]),i.audioName=l[t]}function A(t){return a.includes(t)}function S(){return u[i.currentState].length-1===f}function N(){return 0===f}function g(t){i.imageName=t}this.changeState=function(t){return Assert.assert(A(t)),this.currentState=t,f=0,h(t),this.audioName&&e.playSoundInClient(this.audioName),r&&clearInterval(r),r=setInterval(function(){S()||N()?(S()&&d[i.currentState]&&d[i.currentState].call(i),o?((N()&&-1===c||S()&&1===c)&&(c*=-1),f+=c,g(u[i.currentState][f])):(S()?f=0:f++,g(u[i.currentState][f]))):(f+=c,g(u[i.currentState][f]))},m[t]),this},this.addActionToExecuteAtAnimationEnd=function(t,e){return Assert.assert(A(t),"Animated#addActionToAnimationEnd error -> given state is not valid"),Assert.assertIsFunction(e,"Animated#addActionToAnimationEnd error -> action expected to be a function"),d[t]=e,this},this.die=EFunction.sequence(this.die,function(){clearInterval(r)},this),function(t){try{s=i.currentState=t.defaultState,o=t.auto_reverse,t.animationStates.forEach(function(t){a.push(t.stateName),u[t.stateName]=t.animationFrames,m[t.stateName]=t.timeinMilis||n,l[t.stateName]=t.audioName}),h(s)}catch(t){throw"Animation resources descriptor reading error: "+t}Assert.assert(a.includes(s),"Animation resources integrity check failed"),i.changeState(s)}(t)};